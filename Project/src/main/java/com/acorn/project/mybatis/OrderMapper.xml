<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="order">

	<insert id="getInfo" parameterType="orderDto">
		INSERT INTO ordertable
		(orderId, userId, userAddr, userPostal, userAddrDetail, tel, totalPrice, orderDate)
	 	values(orderId_seq.nextval, #{userId}, #{userAddr}, #{userPostal}, #{userAddrDetail}, #{tel}, #{totalPrice}, SYSDATE)
	</insert>
	
	<insert id="getInfo_Detail" parameterType="cartDto" >
		INSERT INTO ordertable_detail
		(orderId_detail, orderId, productId, amount_detail, userId)
		(SELECT orderId_detail_seq.nextval, #{orderId}, productId, amount, #{userId} FROM cart WHERE id=#{userId})
	</insert>
	
	<select id="getOrderId" resultType="int">
		select max(orderId) as orderId from ordertable
	</select>
	
	<!-- 카트 비우기 -->
	<delete id="emptyCart" parameterType="string">
 		DELETE FROM cart
     	WHERE id = #{userId}
	</delete>
	
	<select id="orderList" resultType="orderDto">
		SELECT orderId, userId, userAddr, userPostal, userAddrDetail, tel, totalPrice, orderDate
		FROM ordertable
		where userId=#{userId}
	</select>
	<!-- 특정 주문 목록 -->
	<select id="orderDetailList" resultType="com.acorn.project.order.dto.OrderListDto">
		 SELECT o.orderId, o.userId, o.userAddr, o.userPostal, o.userAddrDetail, o.tel, o.totalPrice, o.orderDate, d.orderId_detail, d.productId, d.amount_detail, p.productName, p.imagePath, p.price 
		 FROM ordertable o
		 INNER JOIN ordertable_detail d ON o.orderId = d.orderId
		 INNER JOIN product p ON d.productId = p.productId
		 WHERE o.userId=#{userId} OR o.orderId=#{orderId}

</select>
</mapper>







